{% include base_path %}

{% assign from_date_parts = experience.from | split: "-" %}
{% assign to_date_parts = experience.to | split: "-" %}

{% capture from_date %}
  {% case from_date_parts.size %}
    {% when 3 %}
      {{ experience.from | date: "%Y%m%d" }}
    {% when 2 %}
      {{ experience.from | append: "-01" | date: "%Y%m" }}
    {% when 1 %}
      {{ experience.from | append: "-01-01" | date: "%Y" }}
  {% endcase %}
{% endcapture %}

{% capture to_date %}
  {% if experience.to %}
    {% case to_date_parts.size %}
      {% when 3 %}
        {{ experience.to | date: "%Y%m%d" }}
      {% when 2 %}
        {{ experience.to | append: "-01" | date: "%Y%m" }}
      {% when 1 %}
        {{ experience.to | append: "-01-01" | date: "%Y" }}
    {% endcase %}
  {% else %}
    99999999
  {% endif %}
{% endcapture %}

{% assign experience.from_date = from_date %}
{% assign experience.to_date = to_date %}

<div class="list__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    {% if experience.teaser %}
      <div class="archive__item-teaser">
        <img src=
          {% if experience.teaser contains "://" %}
            "{{ experience.teaser }}"
          {% else %}
            "{{ experience.teaser | prepend: "/images/" | prepend: base_path }}"
          {% endif %}
          alt="">
      </div>
    {% endif %}

    <h2 class="archive__item-title" itemprop="headline">
      {% if experience.URL %}
        <a href="{{ experience.URL }}">{{ experience.title }}</a> <a href="{{ base_path }}{{ experience.url }}" rel="permalink"><i class="fa fa-link" aria-hidden="true" title="permalink"></i><span class="sr-only">Permalink</span></a>
      {% else %}
        <a href="{{ base_path }}{{ experience.url }}" rel="permalink">{{ experience.title }}</a>
      {% endif %}
    </h2>

    {% if experience.read_time %}
      <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> {{ experience.read_time }} min read</p>
    {% endif %}

    <p><i>{{ experience.venue }}</i>
      {% case from_date_parts.size %}
        {% when 3 %}
          {{ experience.from | date: "%B %d, %Y" }}
        {% when 2 %}
          {{ experience.from | date: "%B %Y" }}
        {% when 1 %}
          {{ experience.from | date: "%Y" }}
      {% endcase %}
      -
      {% if experience.to %}
        {% case to_date_parts.size %}
          {% when 3 %}
            {{ experience.to | date: "%B %d, %Y" }}
          {% when 2 %}
            {{ experience.to | date: "%B %Y" }}
          {% when 1 %}
            {{ experience.to | date: "%Y" }}
        {% endcase %}
      {% else %}
        present
      {% endif %}
    </p>

    {% if experience.location %}
      <p>{{ experience.location }}</p>
    {% endif %}

    {% if experience.excerpt %}
      <p class="archive__item-excerpt" itemprop="description">{{ experience.excerpt }}</p>
    {% endif %}

    {% if experience.details %}
      <ul>
        {% for detail in experience.details %}
          <li>{{ detail }}</li>
        {% endfor %}
      </ul>
    {% endif %}

    {% if experience.citation and experience.documenturl %}
      <p>Recommended citation: {{ experience.citation }}<br /><a href="{{ experience.documenturl }}">Download Experience Document</a></p>
    {% elsif experience.citation %}
      <p>Recommended citation: {{ experience.citation }}</p>
    {% elsif experience.documenturl %}
      <p><a href="{{ experience.documenturl }}">Download Experience Document</a></p>
    {% endif %}
  </article>
</div>
